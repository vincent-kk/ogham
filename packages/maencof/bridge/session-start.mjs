#!/usr/bin/env node
import{existsSync as i,readFileSync as S,readdirSync as y}from"node:fs";import{join as _}from"node:path";import{existsSync as m}from"node:fs";import{join as a}from"node:path";var p=".maencof-meta",w=".maencof";function l(t){return m(a(t,w))||m(a(t,p))}function s(t,...n){return a(t,p,...n)}async function g(){let t=[];for await(let n of process.stdin)t.push(n);return Buffer.concat(t).toString("utf-8")}function d(t){process.stdout.write(JSON.stringify(t))}function h(t){let n=t.cwd??process.cwd(),e=[];if(!l(n))return{continue:!0,message:"[maencof] vault\uAC00 \uCD08\uAE30\uD654\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. `/maencof:setup`\uC744 \uC2E4\uD589\uD558\uC5EC \uC2DC\uC791\uD558\uC138\uC694."};let f=s(n,"wal.json");i(f)&&e.push("[maencof] \uC774\uC804 \uC138\uC158\uC758 \uBBF8\uC644\uB8CC \uD2B8\uB79C\uC7AD\uC158(WAL)\uC774 \uAC10\uC9C0\uB410\uC2B5\uB2C8\uB2E4. `/maencof:doctor`\uB85C \uC9C4\uB2E8\uD558\uC138\uC694.");let c=s(n,"schedule-log.json");if(i(c))try{let o=JSON.parse(S(c,"utf-8"));o.pending&&o.pending.length>0&&e.push(`[maencof] \uC608\uC57D\uB41C \uC791\uC5C5 ${o.pending.length}\uAC1C\uAC00 \uC788\uC2B5\uB2C8\uB2E4. \`/maencof:organize\`\uB85C \uCC98\uB9AC\uD558\uC138\uC694.`)}catch{}let r=s(n,"sessions");if(i(r)){let o=P(r);o&&e.push(`[maencof] \uC774\uC804 \uC138\uC158 \uC694\uC57D:
${o}`)}let x=s(n,"data-sources.json");return i(x)||e.push("[maencof] \uC678\uBD80 \uB370\uC774\uD130 \uC18C\uC2A4\uAC00 \uC5F0\uACB0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. `/maencof:connect`\uB85C \uC5F0\uACB0\uD558\uC138\uC694."),{continue:!0,message:e.length>0?e.join(`

`):void 0}}function P(t){try{let n=y(t).filter(r=>r.endsWith(".md")).sort().reverse();if(n.length===0)return null;let e=_(t,n[0]);return S(e,"utf-8").split(`
`).slice(0,10).join(`
`).trim()||null}catch{return null}}var R=await g(),u;try{let t=JSON.parse(R);u=h(t)}catch{u={continue:!0}}d(u);
