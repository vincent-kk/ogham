#!/usr/bin/env node
import{appendFileSync as x,existsSync as R,mkdirSync as E,writeFileSync as A}from"node:fs";import{dirname as S,join as u}from"node:path";var a={maencof_create:"document",maencof_read:"document",maencof_update:"document",maencof_delete:"document",maencof_move:"document",kg_search:"search",kg_navigate:"search",kg_context:"search",kg_build:"index",kg_status:"index",kg_suggest_links:"search",claudemd_merge:"config",claudemd_read:"config",claudemd_remove:"config"};var k="dailynotes";function $(t){return u(t,".maencof-meta",k)}function w(t,e){let n=e??m(new Date);return u($(t),`${n}.md`)}function C(t){let e=t.path?` \u2192 ${t.path}`:"";return`- **[${t.time}]** \`${t.category}\` ${t.description}${e}`}function d(t,e){let n=w(t),r=S(n);E(r,{recursive:!0});let o=C(e);if(R(n))x(n,o+`
`,"utf-8");else{let i=`# Dailynote \u2014 ${m(new Date)}

## Activity Log

`;A(n,i+o+`
`,"utf-8")}}function g(t,e){let n=a[t];switch(t){case"maencof_create":{let r=e.layer??"?",o=Array.isArray(e.tags)?e.tags.join(", "):"";return`\uBB38\uC11C \uC0DD\uC131 (L${r}${o?`, tags: ${o}`:""})`}case"maencof_update":return"\uBB38\uC11C \uC218\uC815";case"maencof_delete":return"\uBB38\uC11C \uC0AD\uC81C";case"maencof_move":return`\uBB38\uC11C \uC774\uB3D9 (\u2192 L${e.target_layer??"?"})`;case"claudemd_merge":return"CLAUDE.md \uC9C0\uC2DC\uBB38 \uBCD1\uD569";case"claudemd_remove":return"CLAUDE.md \uC9C0\uC2DC\uBB38 \uC81C\uAC70";case"claudemd_read":return"CLAUDE.md \uC9C0\uC2DC\uBB38 \uC77D\uAE30";case"kg_search":return`KG \uAC80\uC0C9 (seed: ${Array.isArray(e.seed)?e.seed.join(", "):""})`;case"kg_navigate":return"KG \uD0D0\uC0C9";case"kg_context":return"\uBB38\uB9E5 \uC870\uB9BD";case"kg_build":return e.force?"\uC778\uB371\uC2A4 \uC804\uCCB4 \uC7AC\uBE4C\uB4DC":"\uC778\uB371\uC2A4 \uC99D\uBD84 \uBE4C\uB4DC";case"kg_status":return"Vault \uC0C1\uD0DC \uC870\uD68C";case"kg_suggest_links":return"\uB9C1\uD06C \uCD94\uCC9C";default:return n?`${n} \uC791\uC5C5`:t}}function f(t){let e=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0");return`${e}:${n}`}function m(t){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}import{existsSync as l}from"node:fs";import{join as p}from"node:path";var O=".maencof-meta",L=".maencof";function y(t){return l(p(t,L))||l(p(t,O))}async function _(){let t=[];for await(let e of process.stdin)t.push(e);return Buffer.concat(t).toString("utf-8")}function D(t){process.stdout.write(JSON.stringify(t))}function h(t){try{let e=t.cwd??process.cwd(),n=t.tool_name??"";if(!y(e))return{continue:!0};let r=a[n];if(!r)return{continue:!0};let o=t.tool_input??{},c=g(n,o),i=o.path??o.file_path??P(t.tool_response)??void 0;d(e,{time:f(new Date),category:r,description:c,path:i})}catch{}return{continue:!0}}function P(t){if(!t)return null;try{if(typeof t.path=="string"&&t.path)return t.path;let e=t.content;if(Array.isArray(e)&&e.length>0){let n=e[0];if(n.type==="text"&&n.text){let r=JSON.parse(n.text);if(typeof r.path=="string"&&r.path)return r.path}}}catch{}return null}var M=await _(),s;try{let t=JSON.parse(M);s=h(t)}catch{s={continue:!0}}D(s);
