#!/usr/bin/env node
import{appendFileSync as x,existsSync as R,mkdirSync as E,writeFileSync as k}from"node:fs";import{dirname as A,join as u}from"node:path";var i={maencof_create:"document",maencof_read:"document",maencof_update:"document",maencof_delete:"document",maencof_move:"document",kg_search:"search",kg_navigate:"search",kg_context:"search",kg_build:"index",kg_status:"index",kg_suggest_links:"search",claudemd_merge:"config",claudemd_read:"config",claudemd_remove:"config"};var S="dailynotes";function $(t){return u(t,".maencof-meta",S)}function w(t,e){let n=e??l(new Date);return u($(t),`${n}.md`)}function C(t){let e=t.path?` \u2192 ${t.path}`:"";return`- **[${t.time}]** \`${t.category}\` ${t.description}${e}`}function d(t,e){let n=w(t),r=A(n);E(r,{recursive:!0});let o=C(e);if(R(n))x(n,o+`
`,"utf-8");else{let a=`# Dailynote \u2014 ${l(new Date)}

## Activity Log

`;k(n,a+o+`
`,"utf-8")}}function g(t,e){let n=i[t];switch(t){case"maencof_create":{let r=e.layer??"?",o=Array.isArray(e.tags)?e.tags.join(", "):"";return`Document created (L${r}${o?`, tags: ${o}`:""})`}case"maencof_update":return"Document updated";case"maencof_delete":return"Document deleted";case"maencof_move":return`Document moved (\u2192 L${e.target_layer??"?"})`;case"claudemd_merge":return"CLAUDE.md directive merged";case"claudemd_remove":return"CLAUDE.md directive removed";case"claudemd_read":return"CLAUDE.md directive read";case"kg_search":return`KG search (seed: ${Array.isArray(e.seed)?e.seed.join(", "):""})`;case"kg_navigate":return"KG navigation";case"kg_context":return"Context assembly";case"kg_build":return e.force?"Full index rebuild":"Incremental index build";case"kg_status":return"Vault status check";case"kg_suggest_links":return"Link suggestion";default:return n?`${n} task`:t}}function m(t){let e=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0");return`${e}:${n}`}function l(t){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}import{existsSync as f}from"node:fs";import{join as p}from"node:path";var v=".maencof-meta",O=".maencof";function y(t){return f(p(t,O))||f(p(t,v))}async function _(){let t=[];for await(let e of process.stdin)t.push(e);return Buffer.concat(t).toString("utf-8")}function D(t){process.stdout.write(JSON.stringify(t))}function h(t){try{let e=t.cwd??process.cwd(),n=t.tool_name??"";if(!y(e))return{continue:!0};let r=i[n];if(!r)return{continue:!0};let o=t.tool_input??{},c=g(n,o),a=o.path??o.file_path??L(t.tool_response)??void 0;d(e,{time:m(new Date),category:r,description:c,path:a})}catch{}return{continue:!0}}function L(t){if(!t)return null;try{if(typeof t.path=="string"&&t.path)return t.path;let e=t.content;if(Array.isArray(e)&&e.length>0){let n=e[0];if(n.type==="text"&&n.text){let r=JSON.parse(n.text);if(typeof r.path=="string"&&r.path)return r.path}}}catch{}return null}var P=await _(),s;try{let t=JSON.parse(P);s=h(t)}catch{s={continue:!0}}D(s);
