#!/usr/bin/env node
import{existsSync as _,readFileSync as E}from"node:fs";import{existsSync as l}from"node:fs";import{join as i}from"node:path";var p=".maencof-meta",L=".maencof";function m(e){return l(i(e,L))||l(i(e,p))}function g(e,...t){return i(e,p,...t)}async function y(){let e=[];for await(let t of process.stdin)e.push(t);return Buffer.concat(e).toString("utf-8")}function d(e){process.stdout.write(JSON.stringify(e))}var S=new Set(["SessionStart","UserPromptSubmit","PreToolUse","PostToolUse","Stop","SessionEnd"]);function h(e,t){let n=t.cwd??process.cwd();if(!m(n))return{continue:!0};if(!S.has(e))return{continue:!0};let r=e,c=x(n);if(!c||c.actions.length===0)return{continue:!0};let f=c.actions.filter(s=>w(s,r,t.tool_name));if(f.length===0)return{continue:!0};let o=[];for(let s of f){let u=P(s);u&&o.push(u)}return{continue:!0,message:o.length>0?o.join(`
`):void 0}}function x(e){let t=g(e,"lifecycle.json");if(!_(t))return null;try{let n=E(t,"utf-8"),r=JSON.parse(n);return r.version!==1||!Array.isArray(r.actions)?null:r}catch{return null}}function w(e,t,n){return!e.enabled||e.event!==t?!1:(t==="PreToolUse"||t==="PostToolUse")&&e.matcher&&n?e.matcher.split("|").map(c=>c.trim()).includes(n):!0}function P(e){switch(e.type){case"echo":{let t=e.config.message;return t?`[maencof:lifecycle] ${t}`:null}case"remind":{let t=e.config;return t.message?`[maencof:lifecycle] ${t.message}`:null}default:return null}}var A=process.argv[2]??"",D=await y(),a;try{let e=JSON.parse(D);a=h(A,e)}catch{a={continue:!0}}d(a);
