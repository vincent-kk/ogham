#!/usr/bin/env node
import{existsSync as S,readFileSync as _}from"node:fs";import{existsSync as l}from"node:fs";import{join as i}from"node:path";var p=".maencof-meta",L=".maencof";function m(e){return l(i(e,L))||l(i(e,p))}function g(e,...t){return i(e,p,...t)}async function y(){let e=[];for await(let t of process.stdin)e.push(t);return Buffer.concat(e).toString("utf-8")}function h(e){process.stdout.write(JSON.stringify(e))}var E=new Set(["SessionStart","UserPromptSubmit","PreToolUse","PostToolUse","Stop","SessionEnd"]);function d(e,t){let n=t.cwd??process.cwd();if(!m(n))return{continue:!0};if(!E.has(e))return{continue:!0};let r=e,c=w(n);if(!c||c.actions.length===0)return{continue:!0};let a=c.actions.filter(s=>x(s,r,t.tool_name));if(a.length===0)return{continue:!0};let o=[];for(let s of a){let u=P(s);u&&o.push(u)}return{continue:!0,message:o.length>0?o.join(`
`):void 0}}function w(e){let t=g(e,"lifecycle.json");if(!S(t))return null;try{let n=_(t,"utf-8"),r=JSON.parse(n);return r.version!==1||!Array.isArray(r.actions)?null:r}catch{return null}}function x(e,t,n){return!e.enabled||e.event!==t?!1:(t==="PreToolUse"||t==="PostToolUse")&&e.matcher&&n?e.matcher.split("|").map(c=>c.trim()).includes(n):!0}function P(e){switch(e.type){case"echo":{let t=e.config.message;return t?`[maencof:lifecycle] ${t}`:null}case"remind":{let t=e.config;return t.message?`[maencof:lifecycle] ${t.message}`:null}default:return null}}var A=process.argv[2]??"",R=await y(),f;try{let e=JSON.parse(R);f=d(A,e)}catch{f={continue:!0}}h(f);
