#!/usr/bin/env node
import{existsSync as r}from"node:fs";import{join as a}from"node:path";function i(e){return r(a(e,".filid"))||r(a(e,"CLAUDE.md"))}var c={"fractal-architect":"ROLE RESTRICTION: You are a Fractal Architect agent. You MUST NOT use Write or Edit tools. You are read-only \u2014 analyze structure, design, plan, and draft proposals only.","qa-reviewer":"ROLE RESTRICTION: You are a QA/Reviewer agent. You MUST NOT use Write or Edit tools. Review, analyze, and report only.",implementer:"ROLE RESTRICTION: You are an Implementer agent. You MUST only implement within the scope defined by SPEC.md. Do not make architectural changes beyond the approved specification.","context-manager":"ROLE RESTRICTION: You are a Context Manager agent. You may only edit CLAUDE.md and SPEC.md documents. Do not modify business logic or source code.","drift-analyzer":"ROLE RESTRICTION: You are a Drift Analyzer agent. You MUST NOT use Write or Edit tools. You are read-only \u2014 detect drift, classify severity, and produce correction plans only.",restructurer:"ROLE RESTRICTION: You are a Restructurer agent. You may only execute actions from an approved restructuring plan. Do not make structural decisions or modify business logic.","code-surgeon":"ROLE RESTRICTION: You are a Code Surgeon agent. You MUST apply only the approved fix item specified in the task. Do not modify files outside the fix scope or apply collateral changes."},d=["[FCA-AI Development Workflow]","When designing a plan, include CLAUDE.md/SPEC.md update steps:","1. Identify affected fractal modules (directories with CLAUDE.md)","2. Plan SPEC.md updates for requirements/API changes BEFORE code","3. Plan CLAUDE.md updates if boundaries or conventions change","4. New modules need CLAUDE.md (max 100 lines, 3-tier) + SPEC.md"].join(`
`),p=["[FCA-AI Pre-Implementation Check]","Before writing code, verify CLAUDE.md/SPEC.md are updated for planned changes.","SPEC.md first (requirements), then CLAUDE.md if boundaries change."].join(`
`),l=/^oh-my-claudecode:(planner|architect|analyst|critic)$/,m=/^oh-my-claudecode:(executor|deep-executor)$/;function u(e){let t=e.agent_type??"",n=c[t];return n?{continue:!0,hookSpecificOutput:{additionalContext:n}}:i(e.cwd)?l.test(t)||t==="Plan"?{continue:!0,hookSpecificOutput:{additionalContext:d}}:m.test(t)||t==="general-purpose"?{continue:!0,hookSpecificOutput:{additionalContext:p}}:{continue:!0}:{continue:!0}}var s=[];for await(let e of process.stdin)s.push(e);var f=Buffer.concat(s).toString("utf-8"),o;try{let e=JSON.parse(f);o=u(e)}catch{o={continue:!0}}process.stdout.write(JSON.stringify(o));
