#!/usr/bin/env node
import{existsSync as g,writeFileSync as w,mkdirSync as E,readdirSync as x,statSync as I,unlinkSync as _}from"node:fs";import{join as m}from"node:path";import{existsSync as f}from"node:fs";import{join as c}from"node:path";var a=".coffaen-meta",y=".coffaen";function d(t){return f(c(t,y))||f(c(t,a))}function l(t,...s){return c(t,a,...s)}async function p(){let t=[];for await(let s of process.stdin)t.push(s);return Buffer.concat(t).toString("utf-8")}function S(t){process.stdout.write(JSON.stringify(t))}var $=30;function h(t){let s=t.cwd??process.cwd();if(!d(s))return{continue:!0};let e=l(s,"sessions");D(e);let i=k(t),o=N(),n=m(e,o);try{w(n,i,"utf-8")}catch{}return R(e),{continue:!0}}function k(t){let s=new Date().toISOString(),e=t.session_id??"unknown",i=t.skills_used??[],o=t.files_modified??[],n=["# \uC138\uC158 \uC694\uC57D","",`- **\uC138\uC158 ID**: ${e}`,`- **\uC885\uB8CC \uC2DC\uAC01**: ${s}`,""];if(i.length>0){n.push("## \uC0AC\uC6A9\uB41C \uC2A4\uD0AC"),n.push("");for(let r of i)n.push(`- ${r}`);n.push("")}if(o.length>0){n.push("## \uC218\uC815\uB41C \uBB38\uC11C"),n.push("");for(let r of o)n.push(`- ${r}`);n.push("")}return i.length===0&&o.length===0&&(n.push("> \uC774 \uC138\uC158\uC5D0\uC11C \uAE30\uB85D\uB41C \uD65C\uB3D9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4."),n.push("")),n.join(`
`)}function N(){let t=new Date,s=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0"),r=String(t.getSeconds()).padStart(2,"0");return`${s}-${e}-${i}-${o}${n}${r}.md`}function R(t){if(!g(t))return;let s=$*24*60*60*1e3,e=Date.now();try{let i=x(t).filter(o=>o.endsWith(".md"));for(let o of i){let n=m(t,o);try{let r=I(n);e-r.mtimeMs>s&&_(n)}catch{}}}catch{}}function D(t){g(t)||E(t,{recursive:!0})}var F=await p(),u;try{let t=JSON.parse(F);u=h(t)}catch{u={continue:!0}}S(u);
