#!/usr/bin/env node
import{existsSync as m,mkdirSync as w,readdirSync as _,statSync as E,unlinkSync as x,writeFileSync as I}from"node:fs";import{join as g}from"node:path";import{existsSync as u}from"node:fs";import{join as c}from"node:path";var a=".coffaen-meta",y=".coffaen";function d(t){return u(c(t,y))||u(c(t,a))}function l(t,...s){return c(t,a,...s)}async function p(){let t=[];for await(let s of process.stdin)t.push(s);return Buffer.concat(t).toString("utf-8")}function S(t){process.stdout.write(JSON.stringify(t))}var $=30;function h(t){let s=t.cwd??process.cwd();if(!d(s))return{continue:!0};let o=l(s,"sessions");N(o);let i=O(t),e=k(),n=g(o,e);try{I(n,i,"utf-8")}catch{}return F(o),{continue:!0}}function O(t){let s=new Date().toISOString(),o=t.session_id??"unknown",i=t.skills_used??[],e=t.files_modified??[],n=["# \uC138\uC158 \uC694\uC57D","",`- **\uC138\uC158 ID**: ${o}`,`- **\uC885\uB8CC \uC2DC\uAC01**: ${s}`,""];if(i.length>0){n.push("## \uC0AC\uC6A9\uB41C \uC2A4\uD0AC"),n.push("");for(let r of i)n.push(`- ${r}`);n.push("")}if(e.length>0){n.push("## \uC218\uC815\uB41C \uBB38\uC11C"),n.push("");for(let r of e)n.push(`- ${r}`);n.push("")}return i.length===0&&e.length===0&&(n.push("> \uC774 \uC138\uC158\uC5D0\uC11C \uAE30\uB85D\uB41C \uD65C\uB3D9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4."),n.push("")),n.join(`
`)}function k(){let t=new Date,s=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),e=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0"),r=String(t.getSeconds()).padStart(2,"0");return`${s}-${o}-${i}-${e}${n}${r}.md`}function F(t){if(!m(t))return;let s=$*24*60*60*1e3,o=Date.now();try{let i=_(t).filter(e=>e.endsWith(".md"));for(let e of i){let n=g(t,e);try{let r=E(n);o-r.mtimeMs>s&&x(n)}catch{}}}catch{}}function N(t){m(t)||w(t,{recursive:!0})}var R=await p(),f;try{let t=JSON.parse(R);f=h(t)}catch{f={continue:!0}}S(f);
