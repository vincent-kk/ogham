---
created: 2026-02-28
updated: 2026-02-28
tags: [runtime, constraints, go-no-go, claude-code]
layer: meta
---

# Phase 0 — Claude Code 런타임 제약 분석 및 go/no-go 게이트

## 목적

coffaen 설계의 시작점. 이론적으로 원하는 기능이 Claude Code 런타임에서 실현 가능한지
사전에 판별하여, 이후 모든 설계 결정의 근거로 삼는다.

관련 문서: [설계 원칙](./01-design-principles.md) | [플러그인 아키텍처](./14-plugin-architecture.md)

---

## 1. Claude Code 런타임 제약 4가지

| # | 제약 | 내용 |
|---|------|------|
| C1 | **Hook 타임아웃** | PreToolUse/PostToolUse/SessionStart 훅은 3-5초 내 완료 필수. 초과 시 무시 또는 에러 처리. |
| C2 | **세션 간 상태 불가** | 메모리·변수는 세션 종료 시 소멸. 영속 정보는 파일 시스템에만 저장 가능. |
| C3 | **MCP 단일 요청-응답** | 각 MCP 도구 호출은 독립적인 요청-응답 사이클. 스트리밍·구독·장기 연결 불가. |
| C4 | **비상주 런타임** | 플러그인은 사용자가 Claude Code를 열 때만 실행. 백그라운드 프로세스·크론 불가. |

---

## 2. go/no-go 게이트 테이블

| 설계 영역 | 이론 원형 | go/no-go | 실현 가능 범위 | fallback |
|----------|----------|----------|--------------|----------|
| 확산 활성화 | 그래프 전체 전파 | CONSTRAINED | BFS 2-hop | 1-hop 축소 |
| 기억 전이 | 자동 실시간 전이 | CONSTRAINED | SessionStart Hook 지연 전이 | 수동 스킬 호출 |
| 벡터 검색 | 임베딩 DB | NO-GO (기본) | 태그+Frontmatter 검색 | 벡터는 선택적 확장 |
| 자율 스케줄 | 크론 자동 실행 | CONSTRAINED | Lazy Scheduling | 수동 트리거 |
| 실시간 모니터링 | 상시 감시 | NO-GO | 세션 시작 시 점검 | 사후 감지만 |

- **GO**: 제약 없이 구현 가능
- **CONSTRAINED**: 제약 범위 내에서 부분 구현 가능
- **NO-GO (기본)**: 기본 구현에서 배제, 선택적 확장으로만 허용

---

## 3. 확산 활성화 홉 수 분석

이론 모델은 그래프 전체를 전파하는 무제한 홉을 가정하지만,
Hook 타임아웃(C1)으로 인해 홉 수를 엄격히 제한해야 한다.

| 홉 수 | 판정 | 근거 |
|-------|------|------|
| 1-hop | 안전 | 직접 링크 파일 읽기 → 타임아웃 내 완료 |
| 2-hop | 조건부 | 링크 파일 수가 적을 때만 허용 (≤10개 노드) |
| 3-hop+ | NO-GO | 파일 I/O 누적으로 타임아웃 초과 위험 |

설계 결정: 기본은 1-hop, 사용자 명시 요청 시 2-hop 허용. 3-hop 이상은 배제.

---

## 4. 기억 전이 파일 시스템 동작 범위

세션 간 상태 불가(C2) 제약 하에서 기억 전이가 가능한 범위와 불가 범위를 구분한다.

**가능한 동작**
- SessionStart Hook 실행 시 파일 시스템 스캔 및 인덱스 갱신
- 파일 기반 Frontmatter를 통한 메타데이터 읽기/쓰기
- 링크 인덱스 파일(backlinks.json 등) 갱신
- 사용자 승인 후 문서 이동/복사 (Layer 간 전이)

**불가한 동작**
- 세션 종료 후 자동 전이 실행
- 실시간 파일 감시 (inotify/FSEvents 기반 자동 반응)
- 크론 기반 주기적 전이
- 메모리 내 캐시를 통한 고속 그래프 탐색
