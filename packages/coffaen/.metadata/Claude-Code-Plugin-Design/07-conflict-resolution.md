---
created: 2026-02-28
updated: 2026-02-28
tags: [conflict-resolution, deduplication, merge, consistency]
layer: design-area-2
---

# 충돌 해소 — 중복 방지, 병합/갱신/충돌 전략

## 목적

새 문서 생성 시 기존 문서와의 중복을 탐지하고,
충돌 유형별로 병합·갱신·링크 전환·사용자 판단 중 최적 경로를 선택하는 규칙을 정한다.

관련 문서: [원자적 문서 정책](./03-atomic-document-policy.md) | [Frontmatter 스키마](./05-frontmatter-schema.md) | [링크 메커니즘](./04-link-mechanism.md)

---

## 1. 중복 감지 메커니즘 (태그/키워드 매칭 우선)

### 1차: Frontmatter `tags` 교집합 분석

- **Jaccard 유사도** = |태그 교집합| / |태그 합집합|
- 임계값: Jaccard ≥ 0.5 → 중복 후보로 분류
- 런타임 비용: 태그 배열 비교로 타임아웃 내 완료 가능

### 2차: 제목 + 첫 문단 키워드 매칭

- h1 헤딩 및 첫 3줄의 명사·동사 추출 후 교집합 계산
- 1차 통과 문서에 한해 2차 수행 (범위 제한)

### 선택적 확장: 벡터 임베딩

- 기본 구현에서 **배제** (NO-GO 런타임 제약)
- 인터페이스만 정의: `interface SimilarityEngine { score(a, b): number }`
- 외부 임베딩 서버 연동 시 활성화 가능

---

## 2. 중복 발견 시 해소 전략

| 전략 | 설명 | 적용 조건 |
|------|------|----------|
| **병합** | 두 문서 내용을 하나로 통합. 100줄 초과 시 분할 | 동일 Layer + 높은 유사도 |
| **갱신** | 기존 문서에 새 정보 추가 | 기존 문서가 더 완성도 높을 때 |
| **링크 전환** | 중복 문서 대신 기존 문서로 링크 연결 | 다른 Layer + 동일 개념 |
| **사용자 판단** | 자동 결정 불가, 사용자에게 위임 | 애매한 유사도 또는 의미 충돌 |

---

## 3. 충돌 유형별 의사결정 트리

```
새 문서 생성 요청
  ↓
1차 태그 Jaccard 유사도 계산
  ├─ 유사도 < 0.3 → 중복 없음, 그대로 생성
  ├─ 0.3 ≤ 유사도 < 0.5 → 2차 키워드 매칭
  │     ├─ 키워드 교집합 낮음 → 중복 없음, 생성
  │     └─ 키워드 교집합 높음 → 충돌 유형 분류
  └─ 유사도 ≥ 0.5 → 충돌 유형 분류
        ├─ 동일 태그 + 동일 Layer → 병합 제안
        ├─ 동일 태그 + 다른 Layer → 링크 연결 제안
        └─ 다른 태그 + 유사 내용 → 사용자 판단 요청
```

---

## 4. Progressive Autonomy Level별 충돌 해소

| 상황 | Level 0 | Level 1 | Level 2 | Level 3 |
|------|---------|---------|---------|---------|
| 중복 탐지 | 모든 충돌에 사용자 판단 | 전략 제안, 사용자 확인 | 병합/링크 자동 실행 | 병합/링크 자동 실행 |
| 병합 실행 | 승인 필요 | 승인 필요 | 자동 | 자동 |
| 파괴적 삭제 (구 문서 제거) | 승인 필요 | 승인 필요 | 제안 후 확인 | 제안 후 확인 |
| 링크 전환 | 승인 필요 | 자동 | 자동 | 자동 |

**파괴적 작업 정의**: 기존 문서를 삭제하거나 내용을 대폭 교체하는 연산.
병합·링크 삽입 등 보존 위주 작업은 비파괴적으로 분류한다.

---

## 5. 병합 후 100줄 초과 처리

병합 결과가 100줄을 초과하면 [원자적 문서 정책](./03-atomic-document-policy.md)의
분할 정책을 자동 적용한다. 분할 기준은 h2/h3 섹션 경계 우선.
