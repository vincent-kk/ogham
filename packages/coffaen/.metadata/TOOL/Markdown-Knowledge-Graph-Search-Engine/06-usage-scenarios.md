# 06. 사용 시나리오

## 개요

이 도구의 두 가지 사용 대상(AI 에이전트, 인간)에 대한 구체적 시나리오를 기술한다. AI 에이전트가 Primary persona이므로 AI 시나리오를 우선 설계하고, 인간 시나리오는 동일한 기반 위에 포맷팅 레이어를 추가하는 방식으로 파생한다.

## AI 에이전트 시나리오

### 시나리오 A1: 맥락 기반 관련 문서 탐색

**상황**: AI 에이전트가 사용자의 질문에 답하기 위해 관련 문서를 찾아야 한다.

```
사용자: "내 핵심 가치관과 관련된 최근 행동 패턴을 분석해줘"

1. Hook (UserPromptSubmit): 프롬프트에서 키워드 추출 -> "가치관", "행동"
2. Hook: 인덱스에서 매칭 노드 탐색
   - "가치관" -> /01_Core/values.md (Layer 1)
   - "행동" -> /04_Action/2026/02/ 하위 문서들 (Layer 4)
3. Hook: 관련 문서 경로를 system-reminder로 주입
4. AI 에이전트: MCP 도구 kg_search 호출
   - 시드: [/01_Core/values.md]
   - 확산 활성화 실행 -> Layer 2 파생 문서, Layer 4 행동 기록 발견
5. AI 에이전트: MCP 도구 kg_context 호출
   - 상위 10개 결과를 토큰 예산(2000 토큰) 내에서 컨텍스트 블록 수신
6. AI 에이전트: 수신된 컨텍스트를 기반으로 사용자에게 분석 제공
```

**토큰 절약 효과**: 전체 저장소 수백 개 문서 대신 관련 10개 문서의 경로 + 요약만 컨텍스트에 포함. 추정 절약률 90%+.

### 시나리오 A2: 역방향 링크 추적

**상황**: AI 에이전트가 특정 문서의 "영향력 범위"를 파악해야 한다.

```
사용자: "이 가치관 문서가 어떤 행동에 영향을 미치고 있는지 알려줘"

1. AI 에이전트: MCP 도구 kg_navigate 호출
   - 노드: /01_Core/values.md
   - 방향: outbound (이 문서를 링크하는 문서들)
2. 결과: 인바운드 링크 목록 + Layer 정보 + 활성화 점수
   - /02_Derived/skills/decision-making.md (Layer 2, 점수 0.85)
   - /04_Action/2026/02/project-decision.md (Layer 4, 점수 0.62)
3. AI 에이전트: 결과를 분석하여 "이 가치관이 의사결정 기술과 최근 프로젝트 결정에 영향을 미치고 있다"고 보고
```

### 시나리오 A3: 전역 질문 처리 (Phase 2+)

**상황**: AI 에이전트가 저장소 전체에 대한 개괄적 질문에 답해야 한다.

```
사용자: "내 지식 저장소의 핵심 주제가 뭐야?"

1. AI 에이전트: MCP 도구 kg_community 호출
2. 결과: 사전 탐지된 커뮤니티별 요약
   - 커뮤니티 1: "의사결정 프레임워크" (핵심 문서 5개)
   - 커뮤니티 2: "프로그래밍 기술" (핵심 문서 12개)
   - 커뮤니티 3: "인간관계 원칙" (핵심 문서 8개)
3. AI 에이전트: 커뮤니티 요약만으로 전역적 답변 제공 (개별 문서 읽기 불필요)
```

### 시나리오 A4: 토큰 예산 관리

**상황**: AI 에이전트가 제한된 컨텍스트 윈도우에서 최대 관련 정보를 확보해야 한다.

```
1. AI 에이전트: MCP 도구 kg_context 호출
   - 쿼리: "완벽주의 기질과 실수 대처"
   - 토큰 예산: 1500
2. ContextAssembler:
   a. 확산 활성화로 관련 노드 20개 발견
   b. 활성화 점수 기준 내림차순 정렬
   c. 각 노드의 "컨텍스트 비용" 계산 (경로 + Frontmatter 요약 = ~50 토큰)
   d. 토큰 예산 내에서 최대 30개 노드의 메타데이터 포함
   e. 가장 관련성 높은 상위 3개 문서는 전문(full text) 포함 가능 표시
3. 출력: 구조화된 컨텍스트 블록
   - 토큰 비용: ~1400
   - 포함 문서: 30개 (메타데이터) + 3개 (전문 권장)
```

## 인간 (연구자/개발자) 시나리오

### 시나리오 H1: 명시적 검색

**상황**: 연구자가 특정 주제와 관련된 문서를 찾고 싶다.

```
사용자: /coffaen:explore "완벽주의"

1. Skill: 키워드 "완벽주의"를 시드로 확산 활성화 실행
2. 결과를 마크다운 테이블로 포맷팅:

| 순위 | 문서 | Layer | 활성화 점수 | 링크 수 |
|------|------|-------|-----------|---------|
| 1 | /01_Core/temperament/perfectionism.md | 1 | 0.95 | 12 |
| 2 | /02_Derived/skills/quality-control.md | 2 | 0.78 | 5 |
| 3 | /04_Action/2026/02/deadline-miss.md | 4 | 0.61 | 3 |
...

3. 사용자: "2번 문서와 3번 문서의 관계를 더 보여줘"
4. Skill: kg_navigate로 두 문서 간 경로 탐색 -> 관계 설명 출력
```

### 시나리오 H2: 네비게이션 맵

**상황**: 개발자가 특정 문서의 주변 관계를 파악하고 싶다.

```
사용자: /coffaen:explore /01_Core/values.md

1. Skill: kg_navigate로 노드의 전체 연결 맵 조회
2. 결과를 구조적으로 포맷팅:

## /01_Core/values.md
- Layer: 1 (핵심 자아)
- PageRank: 0.089 (상위 3%)
- 인바운드 링크: 24개
- 아웃바운드 링크: 8개

### 링크하는 문서 (아웃바운드)
- /01_Core/boundaries.md (Layer 1, WP 유사도: 0.92)
- /02_Derived/worldview/ethical-framework.md (Layer 2, WP: 0.71)
...

### 링크받는 문서 (인바운드) -- 상위 5
- /04_Action/2026/02/career-decision.md (Layer 4, SA 점수: 0.88)
- /02_Derived/relationships/partner-dynamics.md (Layer 2, SA: 0.76)
...
```

### 시나리오 H3: 인덱스 건강도 진단

**상황**: 연구자가 저장소의 구조적 건강 상태를 점검하고 싶다.

```
사용자: /coffaen:diagnose

1. Skill: 전체 그래프 분석 실행
2. 결과:

## 인덱스 건강도 보고서
- 마지막 빌드: 2분 전 (v0.1, Phase 2)
- 총 문서: 847개 | 총 링크: 2,341개

### 경고
- 고아 문서 (링크 없음): 12개
  - /03_External/misc/orphan-note-1.md
  - ...
- 깨진 링크: 3개
  - /02_Derived/skills/old-skill.md -> [삭제된 파일]
- 순환 참조 (DAG 변환 시 제거됨): 7개
  - /01_Core/values.md <-> /01_Core/boundaries.md

### 권장 조치
- 고아 문서 12개에 대해 링크 추가 또는 삭제 검토
- 깨진 링크 3개 수정 필요
```

## 시나리오 흐름 요약

```
AI 에이전트 경로:
  Hook(자동 주입) -> MCP(kg_search/kg_context) -> 토큰 최적화 출력

인간 경로:
  Skill(명시 호출) -> MCP(내부 오케스트레이션) -> 마크다운 포맷 출력
```

두 경로 모두 동일한 core/ 알고리즘과 .coffaen/ 인덱스를 사용한다. 차이점은 트리거 방식(자동 vs 명시)과 출력 포맷(구조화 JSON vs 마크다운 테이블)뿐이다.
